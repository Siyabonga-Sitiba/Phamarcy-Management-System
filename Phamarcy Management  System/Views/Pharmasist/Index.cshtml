 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pharmacist Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/a2d9d6ea27.js" crossorigin="anonymous"></script>
    <style>
        body {
            background: #f4f6f8;
        }

        .dashboard-header {
            margin: 40px 0 30px;
            text-align: center;
        }

        .status-cards {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 30px;
        }

        .status-card {
            flex: 1;
            min-width: 200px;
            background: #fff;
            border-left: 6px solid #007bff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            cursor: pointer;
            transition: transform 0.2s;
        }

            .status-card:hover {
                transform: translateY(-3px);
            }

            .status-card.active {
                border-left-color: #28a745;
                background-color: #e8f5e9;
            }

            .status-card h4 {
                font-size: 1.5rem;
                margin: 0;
            }

        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .prescription-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.05);
            padding: 20px;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

            .card-header img {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                object-fit: cover;
                margin-right: 15px;
            }

        .status-badge {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 8px;
            display: inline-block;
        }

        .badge-pending {
            background-color: #ffc107;
            color: #000;
        }

        .badge-checked {
            background-color: #0dcaf0;
        }

        .badge-processed {
            background-color: #28a745;
            color: #fff;
        }

        .card-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

            .card-actions button {
                flex: 1;
            }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="dashboard-header">
            <h1>Manage prescriptions efficiently</h1>
        </div>

        <!-- Status Cards -->
        <div class="status-cards">
            <div class="status-card" data-status="All">
                <h4 id="allCount">All: 3</h4>
            </div>
            <div class="status-card" data-status="Pending">
                <h4 id="pendingCount">Pending: 1</h4>
            </div>
            <div class="status-card" data-status="Checked Out">
                <h4 id="checkedCount">Checked Out: 1</h4>
            </div>
            <div class="status-card" data-status="Processed">
                <h4 id="processedCount">Processed: 1</h4>
            </div>
        </div>
        <!-- Search Input -->
        <div class="mb-4">
            <input type="text" id="searchInput" class="form-control form-control-lg" placeholder="Search by Patient, ID..." />
        </div>


         <!-- Prescription Cards -->
        <div class="card-container" id="prescriptionList">
            <!-- Sample Card -->
            <div class="prescription-card" data-prescription-id="123" data-status="Pending" data-notes="Take after meals. Monitor for allergic reaction.">
                <div class="card-header">
                    <img src="https://randomuser.me/api/portraits/men/22.jpg" alt="Patient Photo" />
                    <div>
                        <h5>Senzo S</h5>
                        <span class="status-badge badge-pending" id="status-123">Pending</span>
                    </div>
                </div>
                <div>
                    <p><strong>Drug:</strong> Amoxicillin</p>
                    <p><strong>Dosage:</strong> 250mg</p>
                    <p><strong>Date:</strong> 2025-05-07</p>
                </div>
                <div class="card-actions">
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#dispenseModal">Dispense</button>
                    <button class="btn btn-outline-secondary print-label-btn">Print Label</button>
                    <button class="btn btn-outline-primary view-btn" data-bs-toggle="modal" data-bs-target="#viewModal">View</button>
                </div>
            </div> 
      
       


            <div class="prescription-card" data-status="Checked Out">
                <div class="card-header">
                    <img src="https://randomuser.me/api/portraits/women/36.jpg" alt="Patient Photo">
                    <div>
                        <h5> Zakwa H</h5>
                        <span class="status-badge badge-checked">Checked Out</span>
                    </div>
                </div>
                <div>
                    <p><strong>Drug:</strong> Paracetamol</p>
                    <p><strong>Dosage:</strong> 500mg</p>
                    <p><strong>Date:</strong> 2025-05-06</p>
                </div>
                <div class="card-actions">
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#dispenseModal">Dispense</button>
                    <button class="btn btn-outline-secondary print-label-btn">Print Label</button>
                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#viewModal">View</button>
                </div>

            </div>

            <div class="prescription-card" data-status="Processed">
                <div class="card-header">
                    <img src="https://randomuser.me/api/portraits/men/41.jpg" alt="Patient Photo">
                    <div>
                        <h5>Siyabonga S</h5>
                        <span class="status-badge badge-processed">Processed</span>
                    </div>
                </div>
                <div>
                    <p><strong>Drug:</strong> Ibuprofen</p>
                    <p><strong>Dosage:</strong> 400mg</p>
                    <p><strong>Date:</strong> 2025-05-01</p>
                </div>
                <div class="card-actions">
                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#viewModal">View</button>
                    <button class="btn btn-outline-secondary print-label-btn">Print Label</button>
                </div>
            </div>
        </div>
    </div> 
    

    <!-- Modals -->
    <!-- View Modal -->
    <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="viewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Prescription Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Patient:</strong> Senzo S</p>
                    <p><strong>Drug:</strong> Amoxicillin</p>
                    <p><strong>Dosage:</strong> 250mg</p>
                    <p><strong>Status:</strong> Pending</p>
                    <p><strong>Prescribed Date:</strong> 2025-05-07</p>
                    <p><strong>Notes:</strong> Take after meals. Monitor for allergic reaction.</p>
                </div>
                <div class="modal-footer">
                    <a href="/Pharmasist/PharmacistView/1" class="btn btn-primary">Go to View Page</a>
                    <a href="/Pharmasist/PharmacistEdit/1" class="btn btn-warning">Edit Prescription</a>
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dispense Modal -->
    <div class="modal fade" id="dispenseModal" tabindex="-1" role="dialog" aria-labelledby="dispenseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content rounded-3 shadow">
                <form id="dispenseForm">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="dispenseModalLabel">Dispense Prescription</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body px-4 pt-3 pb-1">

                        <!-- Hidden field to hold prescription ID -->
                        <input type="hidden" id="prescriptionId" name="prescriptionId" />

                        <!-- Patient & Prescription Summary -->
                        <div class="mb-4">
                            <h6 class="fw-bold">Patient and Prescription Information</h6>
                            <p><strong>Patient Name:</strong> <span id="patientName">Senzo S</span></p>
                            <p><strong>Drug:</strong> <span id="drugName">Amoxicillin 250mg</span></p>
                            <div class="mb-3">
                                <label for="medicationSelect" class="form-label">Select Medication</label>
                                <select class="form-select" id="medicationSelect" name="medicationId" onchange="populateMedicationDetails()">
                                    <option value="">-- Select Medication --</option>
                                    <option value="1" data-name="Amoxicillin" data-dosage="250mg" data-expiry="2025-12-31">Amoxicillin (250mg)</option>
                                    <option value="2" data-name="Ibuprofen" data-dosage="400mg" data-expiry="2025-10-15">Ibuprofen (400mg)</option>
                                    <option value="3" data-name="Paracetamol" data-dosage="500mg" data-expiry="2026-03-20">Paracetamol (500mg)</option>
                                </select>
                            </div>


                            <div class="mb-3">
                                <label for="dosageInput" class="form-label"><strong>Dosage:</strong></label>
                                <input type="text" class="form-control" id="dosageInput" name="dosage" required />
                            </div>
                        </div>

                        <!-- Dispense Details -->
                        <div class="mb-4">
                            <h6 class="fw-bold">Dispense Details</h6>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="dispenseQty" class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="dispenseQty" name="quantity" min="1" required />
                                </div>
                                <div class="col-md-4">
                                    <label for="expiryDate" class="form-label">Expiry Date</label>
                                    <input type="date" class="form-control" id="expiryDate" name="expiryDate" required />
                                </div>
                                <div class="col-md-4">
                                    <label for="instructions" class="form-label">Instructions</label>
                                    <input type="text" class="form-control" id="instructions" name="instructions" />
                                </div>
                            </div>
                        </div>

                        <!-- Pharmacist Checks -->
                        <div class="mb-4">
                            <h6 class="fw-bold">Pharmacist Checks</h6>
                            <div class="form-check">
                                <input class="form-check-input check-item" type="checkbox" id="checkDosage" />
                                <label class="form-check-label" for="checkDosage">Dosage Confirmed</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input check-item" type="checkbox" id="checkAllergies" />
                                <label class="form-check-label" for="checkAllergies">No Known Allergies</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input check-item" type="checkbox" id="checkInteractions" />
                                <label class="form-check-label" for="checkInteractions">No Drug Interactions</label>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer d-flex justify-content-end px-4 pb-4">
                        <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success" id="confirmDispenseBtn" disabled>Confirm Dispense</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- Mock Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
        <div id="dispenseToast" class="toast align-items-center text-white bg-success border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    ✅ Prescription dispensed successfully!
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>



    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
                // Function to update counts on status cards
        function updateCounts() {
            const allCards = document.querySelectorAll('.prescription-card');
            const pending = document.querySelectorAll('.prescription-card[data-status="Pending"]');
            const checked = document.querySelectorAll('.prescription-card[data-status="Checked Out"]');
            const processed = document.querySelectorAll('.prescription-card[data-status="Processed"]');

            document.getElementById('allCount').innerText = `All: ${allCards.length}`;
            document.getElementById('pendingCount').innerText = `Pending: ${pending.length}`;
            document.getElementById('checkedCount').innerText = `Checked Out: ${checked.length}`;
            document.getElementById('processedCount').innerText = `Processed: ${processed.length}`;
        }

        // Set up filtering on status cards
        document.querySelectorAll('.status-card').forEach(card => {
            card.addEventListener('click', () => {
                const selected = card.getAttribute('data-status');

                document.querySelectorAll('.status-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');

                document.querySelectorAll('.prescription-card').forEach(pres => {
                    if (selected === 'All' || pres.getAttribute('data-status') === selected) {
                        pres.style.display = '';
                    } else {
                        pres.style.display = 'none';
                    }
                });

                // Optionally update counts after filtering, if you want counts to reflect filtered items:
                // updateCounts();
            });
        });

        // Set up search input filtering
        document.getElementById('searchInput').addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase();
            const cards = document.querySelectorAll('.prescription-card');

            cards.forEach(card => {
                const content = card.textContent.toLowerCase();
                if (content.includes(searchTerm)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });

            // Optionally update counts after search:
            // updateCounts();
        });

        // Set up print label button clicks
        document.querySelectorAll('.print-label-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const card = e.target.closest('.prescription-card');
                const patient = card.querySelector('h5').innerText.trim();

                const pElems = card.querySelectorAll('p');
                const drugText = pElems[0]?.textContent.replace('Drug:', '').trim() || '';
                const dosageText = pElems[1]?.textContent.replace('Dosage:', '').trim() || '';
                const dateText = pElems[2]?.textContent.replace('Date:', '').trim() || '';

                         const labelHtml = `
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8" />
          <title>Dispensing Label</title>
          <style>
            body {
              width: 4in;
              height: 2in;
              font-family: Arial, sans-serif;
              font-size: 12pt;
              padding: 10px;
              border: 1px solid #000;
              margin: 0;
            }
            .label-header {
              font-weight: bold;
              font-size: 14pt;
              margin-bottom: 5px;
            }
            .field {
              margin-bottom: 3px;
            }
            .instructions {
              font-style: italic;
              margin-top: 5px;
            }
          </style>
        </head>
        <body>
          <div class="label-header">SZS Pharmacy</div>
          <div class="field"><strong>Patient:</strong> ${patient}</div>
          <div class="field"><strong>Drug:</strong> ${drugText}</div>
          <div class="field"><strong>Dosage:</strong> ${dosageText}</div>
          <div class="field"><strong>Prescribed Date:</strong> ${dateText}</div>
                  <div class="instructions">Take after meals. 2 times a day. Monitor for allergic reaction.</div>
          <div class="field" style="margin-top:10px; font-size:10pt;">Pharmacy Contact: (123) 456-7890</div>

          <script>
            window.onload = function() {
              window.print();
              setTimeout(function() {
                window.close();
              }, 300);
            };
    <\/script>
</body>
</html>`;


        // Open new window and write label
        const printWindow = window.open('', '_blank', 'width=450,height=250');
        printWindow.document.write(labelHtml);
        printWindow.document.close();
    });
})


        // Show or hide print label button based on status
        document.querySelectorAll('.prescription-card').forEach(card => {
            const status = card.getAttribute('data-status');
            const printBtn = card.querySelector('.print-label-btn');
            if (printBtn && !(status === "Processed" || status === "Dispensed")) {
                printBtn.classList.add('hidden');
            }
        })
        // Initial call on page load
        window.onload = () => {
            updateCounts();
            // Optionally set "All" as active filter by default:
            document.querySelector('.status-card[data-status="All"]').classList.add('active');
        };






           let selectedCard = null;

            // Dispense modal open logic
            document.querySelectorAll('.prescription-card button[data-bs-target="#dispenseModal"]').forEach(button => {
                button.addEventListener('click', e => {
                    selectedCard = e.target.closest('.prescription-card');

                    const patientName = selectedCard.querySelector('h5').innerText;
                    const drugName = selectedCard.querySelector('p strong').nextSibling.textContent.trim() + ' ' + selectedCard.querySelector('p:nth-child(2)').textContent.trim();
                    const dosage = selectedCard.querySelector('p:nth-child(2)').textContent.replace('Dosage:', '').trim();

                    document.getElementById('prescriptionId').value = selectedCard.getAttribute('data-prescription-id') || '';
                    document.getElementById('patientName').innerText = patientName;
                    document.getElementById('drugName').innerText = drugName;
                    document.getElementById('dosageInput').value = dosage;

                    document.getElementById('dispenseForm').reset();
                    confirmBtn.disabled = true;
                });
            });

            // Enable Confirm button only when all checkboxes are checked
            const checkboxes = document.querySelectorAll('.check-item');
            const confirmBtn = document.getElementById('confirmDispenseBtn');

            checkboxes.forEach(cb => {
                cb.addEventListener('change', () => {
                    const allChecked = Array.from(checkboxes).every(c => c.checked);
                    confirmBtn.disabled = !allChecked;
                });
            });

            // Handle dispense confirmation
            document.getElementById('dispenseForm').addEventListener('submit', e => {
                e.preventDefault();

                if (!selectedCard) return;

                // Update the card's data-status attribute
                selectedCard.setAttribute('data-status', 'Processed');

                // Update badge
                const badge = selectedCard.querySelector('.status-badge');
                badge.innerText = 'Processed';
                badge.className = 'status-badge badge-processed';

                // Unhide print label button if applicable
                const printBtn = selectedCard.querySelector('.print-label-btn');
                if (printBtn) printBtn.classList.remove('hidden');

                // Update status counts
                updateCounts();

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('dispenseModal'));
                modal.hide();

                // Show toast
                const toast = new bootstrap.Toast(document.getElementById('dispenseToast'));
                toast.show();

                selectedCard = null;
            });

            // Update count indicators (e.g., new, checked out, processed)
            function updateCounts() {
                const cards = document.querySelectorAll('.prescription-card');

                const newCount = Array.from(cards).filter(c => c.getAttribute('data-status') === 'New').length;
                const checkedOutCount = Array.from(cards).filter(c => c.getAttribute('data-status') === 'Checked Out').length;
                const processedCount = Array.from(cards).filter(c => c.getAttribute('data-status') === 'Processed').length;

                document.getElementById('count-new').innerText = newCount;
                document.getElementById('count-checkedout').innerText = checkedOutCount;
                document.getElementById('count-processed').innerText = processedCount;
            }

                        // View modal logic
            document.querySelectorAll('.view-btn').forEach(button => {
                button.addEventListener('click', e => {
                    const card = e.target.closest('.prescription-card');
                    const id = card.getAttribute('data-prescription-id');
                    const name = card.querySelector('h5').innerText;
                    const drug = card.querySelector('p:nth-child(1)').innerText.replace('Drug:', '').trim();
                    const dosage = card.querySelector('p:nth-child(2)').innerText.replace('Dosage:', '').trim();
                    const date = card.querySelector('p:nth-child(3)').innerText.replace('Date:', '').trim();
                    const status = card.getAttribute('data-status');
                    const notes = card.getAttribute('data-notes') || 'N/A';

                    document.getElementById('viewPatient').innerText = name;
                    document.getElementById('viewDrug').innerText = drug;
                    document.getElementById('viewDosage').innerText = dosage;
                    document.getElementById('viewStatus').innerText = status;
                    document.getElementById('viewDate').innerText = date;
                    document.getElementById('viewNotes').innerText = notes;

                             document.getElementById('viewPageBtn').href = `/Pharmasist/PharmacistView/${id}`;
        document.getElementById('editPageBtn').href = `/Pharmasist/PharmacistEdit/${id}`;




                });
            });

 
        function populateMedicationDetails() {
            const select = document.getElementById("medicationSelect");
            const selected = select.options[select.selectedIndex];

            document.getElementById("drugName").textContent = selected.dataset.name || "";
            document.getElementById("dosageInput").value = selected.dataset.dosage || "";
            document.getElementById("expiryDate").value = selected.dataset.expiry || "";
        }
    </script>
</body>
</html>





 